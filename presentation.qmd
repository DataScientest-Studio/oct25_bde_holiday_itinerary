---
title: "Holiday Itinerary Project"
subtitle: "Presentation of Solutions, Data Organization, and Import"
format:
  revealjs:
    theme: default
    smaller: true
    slide-number: true
    header: "Holiday Itinerary Project"
    footer: "Data Architecture & Import"
    mermaid:
        theme: default
  pdf:
    classoption: [landscape]
    pdf-max-pages-per-slide: 1
---

## 1. What the Project Solves

- **Goal:** Provide a system for planning holiday itineraries in France.
- **Problem:** Efficiently managing and querying a large dataset of cities, roads, and diverse Points of Interest (POIs).
- **Solution:**
    - Uses a **Graph Database (Neo4j)** to represent spatial and relational data.
    - Implements **routing algorithms** (TSP, Dijkstra) via a FastAPI wrapper.
    - Connects various tourism data (restaurants, hotels, attractions) with a simulated road network.

---

## 2. Project Architecture
```{mermaid}
%%| fig-align: center
graph LR
    subgraph " "
        direction TB

        subgraph Client Layer
            UI[Streamlit UI]
        end

        subgraph API Layer
            Backend[FastAPI Backend]
        end

        subgraph Database Layer
            Neo4j[(Neo4j Database)]
        end

        subgraph Orchestration Layer
            Airflow[Apache Airflow]
        end
    end

    subgraph External
        DataTourisme[DataTourisme API/Feed]
    end

    UI -->|REST API| Backend
    Backend -->|Bolt Protocol| Neo4j
    Airflow -->|Trigger ETL via REST| Backend
    Backend -->|Download/Extract| DataTourisme
    Backend -->|Import Data| Neo4j

    %% Storage
    subgraph Storage
        Files[(Local Files / Volumes)]
    end

    Backend -.-> Files
    Neo4j -.-> Files
    Airflow -.-> Files
```

---

## 3. Data Organization

### Cities & Roads

:::: {.columns .v-center}

::: {.column width="63%"}
- **City Nodes:** 627 French cities with population and location.
- **Relationships:**
  - `(City)-[:ROAD_TO]->(City)` with distance (km)
:::

::: {.column width="37%"}
![](img/city_road_to.png){fig-align="center"}
:::

::::

---

## 3. Data Organization

### POI & Types

:::: {.columns .v-center}

::: {.column width="63%"}
- **POI Nodes:** Tourism data from DATAtourisme.fr.
- **Type Nodes:** Separate nodes for POI categories (e.g., Restaurant, Hotel):  **Super-Node Pattern**
- **Relationships:**
  - `(POI)-[:IS_A]->(Type)`
  - `(POI)-[:IS_IN]->(City)` (Exact match)
  - `(POI)-[:IS_NEARBY]->(City)` (Closest city within 100km)
:::

::: {.column width="37%"}

![](img/super_node.png){width=120% fig-align="center"}
:::

::::

---

## 4. Spatial Coverage (City & POI)

:::: {.columns .v-center}

::: {.column width="48%"}
![](img/city_coverage.png){width=90% fig-align="center"}

:::

::: {.column width="48%"}
![](img/poi_coverage.png){width=90% fig-align="center"}

:::
::::
*Cities coverage (left) and POI coverage (right)*

---

## 5. How Data is Gained

#### Cities and Roads

:::: {.columns .v-center}

::: {.column width="63%"}
- **Source:** [simplemaps.com](https://simplemaps.com).
- **Road Network (Simulated):**
    - Created using **K-Nearest Neighbors (KNN)** (K=5).
    - **Weakly Connected Components (WCC)** used to identify disconnected clusters.
    - Manual "bridges" added to ensure the entire graph is a single connected component.
:::

::: {.column width="37%"}
![](img/cities_and_roads.png){width=90% fig-align="right"}
:::
::::

#### Points of Interest (POI)
- **Source:** [DATAtourisme.fr](https://www.datatourisme.fr/).
- **Volume:** ~1GB ZIP archive (unpacks to ~8GB JSON).

---

## 6. Data Import Pipeline

:::: {.columns .v-center}
::: {.column width="20%"}
```{mermaid}
%%| fig-align: center
%%{init: {'theme': 'neutral', 'themeVariables': { 'primaryColor': '#e3f2fd', 'primaryTextColor': '#1565c0', 'primaryBorderColor': '#90caf9', 'lineColor': '#b0bec5', 'secondaryColor': '#fff9c4', 'tertiaryColor': '#f1f8e9', 'mainBkg': '#fafafa', 'nodeBorder': '#90caf9', 'clusterBkg': '#ffffff', 'clusterBorder': '#cfd8dc', 'edgeColor': '#90a4ae'}}}%%
graph TB
    Start([Start DAG]) --> Download[Download Data]
    Download --> Unzip[Unzip Archive]
    Unzip --> Extract[Extract & Process]
    Extract --> Import[Import to Neo4j]
    Import --> Cleanup[Cleanup Temp Files]
    Cleanup --> End([End DAG])
```
:::

::: {.column width="53%"}
Orchestrated by **Apache Airflow** via **FastAPI** endpoints:

1. **Trigger Download:** Fetches ZIP from DATAtourisme.
2. **Trigger Unzip:** Extracts data.
3. **Trigger Extract:** Processes JSON and generates Neo4j-compatible CSVs.
4. **Trigger Import:** Loads CSVs using `LOAD CSV` and `apoc.periodic.iterate`.
5. **Trigger Cleanup:** Removes temporary files and old versions.

Whole pipeline takes around 10 min to complete
:::

::: {.column width="20%"}

```{mermaid}
%%| fig-align: center
%%{init: {'theme': 'neutral', 'themeVariables': { 'primaryColor': '#e3f2fd', 'primaryTextColor': '#1565c0', 'primaryBorderColor': '#90caf9', 'lineColor': '#b0bec5', 'secondaryColor': '#fff9c4', 'tertiaryColor': '#f1f8e9', 'mainBkg': '#fafafa', 'nodeBorder': '#90caf9', 'clusterBkg': '#ffffff', 'clusterBorder': '#cfd8dc', 'edgeColor': '#90a4ae'}}}%%
graph TB
    Trigger[Trigger Backend Task] --> Wait{Wait / Poll}
    Wait --> Check{Task done?}
    Check -->|Yes| Next[Next Step]
    Check -->|No| Wait
```

:::
::::

---

## 6. Data Import Pipeline

![](img/airflow_runs_detail.png){width=40% fig-align="right"}

---

## 7. Possible Improvemets

1. Better city coverage and road network.
2. Performance of import.
3. POI data source (web scraping necessary, no API exposed).

---

## Thank You!
## Any Questions?
